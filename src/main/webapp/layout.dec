<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<!-- 
vim:sts=2:sw=2:filetype=xhtml
-->

  <#assign jquery_version="1.6.1">
  <#assign jquery_ui_version="1.8.13">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"> 
<head> 
    <title>${title!'The Digital Archaeological Record'}</title> 
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/> 
    <link rel="unapi-server" type="application/xml" title="unAPI" href="<@s.url value='/unapi'/>" />
    <link rel='icon' href='<@s.url value="/images/tdar-favicon.ico"/>'/>
    <link rel="search" type="application/opensearchdescription+xml" href='<@s.url value="/includes/opensearch.xml"/>' title="Search tDAR" /> 
    <link href='<@s.url value="/css/tdar.css"/>' type="text/css" rel="stylesheet" />
    <link href="<@s.url value="/css/tdar-print.css"/>" type="text/css" rel="stylesheet"    media="print" />
    <#include "${themeDir}/head.dec" />
    <#-- FIXME: are we using a custom jQuery-ui theme? Replace with Google CDN jquery ui CSS if not.
    <link rel="stylesheet" type="text/css" href='https://ajax.googleapis.com/ajax/libs/jqueryui/{{jquery_ui_version}}/themes/base/jquery-ui.css'>/> 
    -->
    <link rel="stylesheet" type="text/css" href='<@s.url value="/css/jquery-ui/jquery-ui-1.8.11.custom.css"/>'/>
    <link rel="stylesheet" type="text/css" href='<@s.url value="/includes/datatables.css"/>'/>
    <link rel="stylesheet" type="text/css" href='<@s.url value="/includes/jquery-treeview/jquery.treeview.css"/>'/> 
    <link rel="stylesheet" type="text/css" href="<@s.url value="/includes/jquery.aw-showcase.1.1.1/jquery.aw-showcase/css/style.css"/>" /> 

<script>

//disabling remote error reporting until it gets fleshed out
/**
var maxExceptions = 1000;

window.onerror = function onError(message, file, linenumber) {
    var oldOnError = window.onerror
    if (maxExceptions > 0) {
        var prefix = "http://www.tdar.org/errors";
        var browser_ = encodeURI(navigator.appVersion);
        var error_ = encodeURI("msg:"+ message + "\n\tfile:"+file+"\n\tln:"+linenumber);
        var user_ = encodeURI("");
    	 
        var url_ = prefix + "?" + "browser=" + browser_ + "&" + "error="+error_ + "&" + "user=" + user_;
        var scrpt =document.createElement("script");
        scrpt.src = url_;
        document.getElementsByTagName("head")[0].appendChild(scrpt);
        maxExceptions--;
    }
    return true;
}
*/

</script>


    <script type='text/javascript' src="http://maps.google.com/maps?file=api&v=2&key=${googleMapsApiKey}"></script>
    <script type='text/javascript' src="<@s.url value='/includes/gzoom_uncompressed.js'/>"></script>
    <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/${jquery_version}/jquery.min.js'></script>
    <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jqueryui/${jquery_ui_version}/jquery-ui.min.js'></script>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript" src="<@s.url value="/includes/jquery.metadata.2.1/jquery.metadata.js"/>"></script> 
    <script type="text/javascript" src="<@s.url value="/includes/jquery.maphighlight.local.js"/>"></script> 
    <script type='text/javascript' src='<@s.url value="/includes/jquery.cookie.js"/>'></script> 
    <script type='text/javascript' src='<@s.url value="/includes/jquery.history.js"/>'></script> 
    <script type='text/javascript' src='<@s.url value="/includes/jquery.xcolor-1.5.js"/>'></script> 
    <script type='text/javascript' src='<@s.url value="/includes/jquery-validation-1.8.1/jquery.validate.min.js"/>'></script> 
    <script type='text/javascript' src='<@s.url value="/includes/jquery-treeview/jquery.treeview.js"/>'></script> 
    <script type='text/javascript' src='<@s.url value="/includes/jquery.datatables-1.8.2/media/js/jquery.dataTables.js"/>'></script>
    <script type='text/javascript' src='<@s.url value="/includes/common.js"/>'></script>
    <script type='text/javascript' src='<@s.url value="/includes/bindWithDelay.js"/>'></script>
    <script type='text/javascript' src="<@s.url value='/includes/jquery.aw-showcase.1.1.1/jquery.aw-showcase/jquery.aw-showcase.js'/>"></script>


    <script type="text/javascript">
        function getBaseURI() {
          return "<@s.url value='/' />";
        }
        function getURI(path) {
            return getBaseURI() + path;
        }
              <li class="page_item"><a href="<@s.url value='https://bitbucket.org/tdar/tdar.dev'/>">Source code</a></li>

        var currentTime = 0;

        <#assign uri = request.requestURI />
        <#if authenticatedUser?? && (uri?index_of("add") > 0 ||
          uri?index_of("edit") > 0 || uri?index_of("workspace") > 0 || uri?index_of("column") > 0 )>
          // ENABLING TIMEOUT WARNING - USER INPUT PAGE
          var sessionTimeout = ${sessionTimeout?c};
          setTimeout(sessionTimeoutWarning,60000);
        </#if>
        
        var GMapDefaultLat = ${GMapDefaultLat};
        var GMapDefaultLng = ${GMapDefaultLng};
  </script>
    <!--Scripts--> 
    
    <!--[if IE]>
    <style type='text/css'>
    .entry ol li p {margin-left: 2em !important; }
    #content .treeview .hitarea { margin-top: 0px !important;}
    .addAnother { position: inherit !important; }    
  </style>
    <![endif]-->
    <!--[if lt IE 8]>
    <style type='text/css'>
      .col2 label+input[type=radio],.col2 label+input[type=checkbox] {
    margin-left: 20em /* ie7 */
}

.col3 label+input[type=radio],.col3 label+input[type=checkbox] {
    margin-left: 13em /* ie7 */
}
      
    </style>
    <![endif]-->


    <!--[if !IE]>
    <style type='text/css'>
       .addAnother {position:relative;}
     </style>
    <![endif]-->

    <!--[if lte IE 7]>
    <script type="text/javascript">
    sfHover=function(){var sfEls=document.getElementById("nav").getElementsByTagName("LI");for(var i=0;i<sfEls.length;i++){sfEls[i].onmouseover=function(){this.className+=" sfhover";}
    sfEls[i].onmouseout=function(){this.className=this.className.replace(new RegExp(" sfhover\\b"),"");}}}
    if (window.attachEvent)window.attachEvent("onload",sfHover);
    </script>
    <![endif]--> 

    ${head}
<script type="text/javascript">
    //FIXME: jquerytree 'lastExpandable' nodes do not render with +/- symbols. Removing the 'lastExpandable-hitarea' class looks better but is still odd.
    $(function() {
        $('.lastExpandable-hitarea').removeClass('lastExpandable-hitarea');
    });
</script>
  <script type="text/javascript">

  var _gaq = _gaq || [];
  <#if !production> 
    _gaq.push(['_setAccount', 'UA-13102200-5']); // TEST ACCOUNT
    _gaq.push(['_setDomainName', 'none']);
  <#else>
    _gaq.push(['_setAccount', '${googleAnalyticsId}']);
  </#if>

  _gaq.push(['_trackPageview']);
  _gaq.push(['_setCustomVar',
      1,                   // This custom var is set to slot #1.  Required parameter.
      'User',     // The name acts as a kind of category for the user activity.  Required parameter.
      '<#if authenticatedUser??>${authenticatedUser.properName?js_string}<#else>anonymous</#if>',               // This value of the custom variable.  Required parameter.
      2                    // Sets the scope to session-level.  Optional parameter.
   ]);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

<#if !production>
     <style type='text/css'>
          body.page { background-color:#efffff !important;border:1px solid blue}
    </style>
</#if> 

</head> 
<body class="page <#if page.properties["div.sidebar"]?? && page.properties["div.sidebar"] != "">twoColumn<#else>singleColumn</#if>" id="docBody"> 
    <div class="skip-content"><a href="#content">Skip to content</a></div> 

    <div id="header" class="clear" style="width:980px;margin-left:auto;margin-right:auto"> 
			<div id="topsection" width="980px">
	          <#include "${themeDir}/header.dec" />
			</div>
          <div id="navigation"> 
            <ul id="nav"> 
              <li class="page_item page-item-1"><a href="<@s.url value='/'/>">Home</a></li>
              <li class="page_item"><a href="<@s.url value='/search/basic'/>">Search</a>
              <ul>
                <li class="page_item"><a href="<@s.url value='/search/basic'/>">Basic Search</a></li>
                <li class="page_item"><a href="<@s.url value='/search/advanced'/>">Advanced Search</a></li>
              </ul>
              </li>
      <#if authenticatedUser??>
        <li class="page_item"><a href="<@s.url value='/workspace/list'/>">Workspace</a>
          <ul>
            <li class="page_item"><a href="<@s.url value='/workspace/list'/>">Show Bookmarked Resources</a></li>
            <li class="page_item"><a href="<@s.url value='/workspace/select-tables'/>">Integrate Bookmarked Data Tables</a></li>
          </ul>
        </li>

      <li class="page_item"><a href="<@s.url value='/dashboard'/>">Your Resources</a></li>
      <#if contributor!false>
        <li class="page_item"><a href="<@s.url value='/resource/add'/>">New</a>
            <ul>
              <li class="page_item"><a href="<@s.url value='/project/add'/>">New Project</a></li>
              <li class="page_item"><a href="<@s.url value='/document/add'/>" class="item_line">New Document</a></li>
              <li class="page_item"><a href="<@s.url value='/image/add'/>">New Image</a></li>
              <li class="page_item"><a href="<@s.url value='/dataset/add'/>">New Dataset</a></li>
              <li class="page_item"><a href="<@s.url value='/coding-sheet/add'/>" class="item_line">New Coding Sheet</a></li>
              <li class="page_item"><a href="<@s.url value='/ontology/add'/>">New Ontology</a></li>
              <li class="page_item"><a href="<@s.url value='/sensory-data/add'/>">New Sensory Data</a></li>
              <li class="page_item"><a href="<@s.url value='/collection/add'/>">New Collection</a></li>
              <li class="page_item" style="border-top: 1px solid #AAA;"><a href="<@s.url value='/batch/add'/>">Batch Upload Tool</a></li>
              
            </ul>
        </li>
        </#if>
        <li class="page_item"><a href="<@s.url value='http://www.tdar.org'/>">About</a></li>
        <#if editor!false>
        <li class="page_item"><a href="/admin/internal">Admin</a>
         <ul>
<!--            <li class="page_item"><a href="<@s.url value='/admin/contributors'/>">Contributor requests</a></li>
            <li class="page_item"><a href="<@s.url value='/admin/activity'/>">Recent activity</a></li> -->
            <li class="page_item"><a href="<@s.url value='/admin/internal'/>">Statistics</a></li>
            <#if administrator!false><li class="page_item"><a href="<@s.url value='/admin/searchindex/build'/>">Build search index</a></li>
            <li class="page_item"><a href="<@s.url value='/admin/system/activity'/>">System Activity</a></li>
            
            </#if>
            <li class="page_item"><a href="<@s.url value='/admin/authority-management/index'/>">Merge duplicates</a></li>
          </ul>
        </li>
        </#if>
            <li class="page_item"><a href="<@s.url value='/logout'/>">Logout</a></li>
        <#else>
        <li class="page_item"><a href="<@s.url value='/login'/>">Login</a></li>
<!--        <li class="page_item"><a href="<@s.url value='http://www.tdar.org'/>">Contribute</a></li>-->
        </#if>
        <li class="page_item">  
        <a href="<@s.url value='http://dev.tdar.org/confluence/display/TDAR/User+Documentation'/>">Help</a>
        
          <ul>
              <li class="page_item"><a href="<@s.url value='http://dev.tdar.org/confluence/display/TDAR/User+Documentation'/>">User Documentation</a></li>
              <li class="page_item"><a href="<@s.url value='http://dev.tdar.org/jira'/>">Report a Bug</a></li>
              <li class="page_item"><a href="mailto:comments@tdar.org">Comments</a></li>
              <#if authenticatedUser??>
              <li class="page_item"><a href="<@s.url value='/entity/person/edit?id=${sessionData.person.id?c}'/>">Update your profile</a></li>
              </#if>
              <li class="page_item"><a href="<@s.url value='https://bitbucket.org/tdar/tdar.dev'/>">Source code</a></li>
          </ul>
        
        </li>
    </ul>

            </div><!--end navigation--> 
        </div><!--end wrapper--> 
    </div><!--end header--> 
<div class="content-background-none"> 
    <div class="wrapper"> 
<div id="internal-wrapper"> 
        <div id="content"> 
        <div class="notice">        </div> 
        <br/>
<#if  page.properties["div.toolbars"]?? && page.properties["div.toolbars"] != "">
    ${page.properties["div.toolbars"]}
</#if>
<#if  page.properties["div.messages"]?? && page.properties["div.messages"] != "">
    ${page.properties["div.messages"]}
</#if>

                <h1 class="pagetitle">${title}<#if  page.properties["div.subtitle"]?? && page.properties["div.subtitle"] != "">${page.properties["div.subtitle"]}
</span></#if></h1> 
        <div class="entry page clear"> 

${body}

    </div><!--end content--> 
 </div>
<#if  page.properties["div.sidebar"]?? && page.properties["div.sidebar"] != "">
    ${page.properties["div.sidebar"]}
</#if>
<!--end sidebar--><div class="clear"></div> 
</div> 
</div><!--end wrapper--> 
</div><!--end content-background--> 
<div id="footer"> 
    <div class="wrapper clear"> 
    <#include "${themeDir}/footer.dec" />
    tDar version #: <#include "version.txt"/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<#if authenticatedUser??>
    Logged in as: <a href="<@s.url value="/browse/creators/${sessionData.person.id?c}"/>">${sessionData.person.email}</a>
</#if>
    </div><!--end wrapper--> 
</div><!--end footer--> 


<#if request.parameterMap.get("fbl")??>
  <!--[if lt IE 10]>
  <script type="text/javascript" src="https://getfirebug.com/firebug-lite.js"></script>
 <![endif]--> 
</#if>


</body> 
</html>
